(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{487:function(e,t,n){"use strict";n(4);var r={data:function(){return{isShowDialog:!1,resolve:null,reject:null,message:null,title:null,options:{color:"primary",width:290,zIndex:200}}},methods:{open:function(title,e,t){var n=this;return this.isShowDialog=!0,this.$nextTick((function(){return n.$refs.cancelDialog.$el.focus()})),this.title=title,this.message=e,this.options=Object.assign(this.options,t),new Promise((function(e,t){n.resolve=e,n.reject=t}))},agree:function(){this.isShowDialog=!1,this.resolve(!0),this.$emit("onOk")},cancel:function(){this.isShowDialog=!1,this.resolve(!1),this.$emit("onCancel")}}},o=n(41),l=n(50),c=n.n(l),d=n(110),v=n(183),f=n(62),h=n(463),m=n(480),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{style:{zIndex:e.options.zIndex},attrs:{"max-width":e.options.width},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.cancel(t)}},model:{value:e.isShowDialog,callback:function(t){e.isShowDialog=t},expression:"isShowDialog"}},[n("v-card",[n("h2",{staticClass:"pl-6 pt-3 pb-2"},[e._v(e._s(e.title))]),e._v(" "),n("v-card-text",{directives:[{name:"show",rawName:"v-show",value:!!e.message,expression:"!!message"}]},[e._v(" "+e._s(e.message)+" ")]),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{ref:"btnOk",attrs:{color:e.options.color,text:""},nativeOn:{click:function(t){return e.agree(t)}}},[e._v("\n        ใช่\n      ")]),e._v(" "),n("v-btn",{ref:"cancelDialog",attrs:{color:"grey",text:""},nativeOn:{click:function(t){return e.cancel(t)}}},[e._v("\n        ไม่\n      ")])],1)],1)],1)}),[],!1,null,null,null);t.a=component.exports;c()(component,{VBtn:d.a,VCard:v.a,VCardActions:f.a,VCardText:f.c,VDialog:h.a,VSpacer:m.a})},629:function(e,t,n){"use strict";n.r(t);n(122),n(42);var r=n(7),o=n(86),l=n.n(o),c={data:function(){return{assignModal:!1,status:[{label:"พักรายการ",value:"pending"},{label:"ทำรายการสำเร็จ",value:"success"},{label:"ยกเลิกรายการ",value:"cancel"}],selectStatus:"pending",startMenuDate:!1,endMenuDate:!1,nowDate:(new Date).toISOString().substr(0,10),startDate:l()().subtract(3,"months").format("YYYY-MM-DD"),endDate:(new Date).toISOString().substr(0,10)}},computed:{start:function(){return this.startDate?l()(this.startDate).format("DD/MM/YYYY"):null},end:function(){return this.endDate?l()(this.endDate).format("DD/MM/YYYY"):null}},watch:{startDate:function(e){null!==this.endDate&&this.emitDate()},endDate:function(e){null!==this.startDate&&this.emitDate()},selectStatus:function(e){localStorage.posState=e,null!==this.startDate&&null!==this.startDate&&this.emitDate()}},mounted:function(){void 0!==localStorage.posState&&(this.selectStatus=localStorage.posState)},methods:{emitDate:function(){this.$emit("updateStatus",{startDate:this.startDate,endDate:this.endDate,state:this.selectStatus})}}},d=n(41),v=n(50),f=n.n(v),h=n(183),m=n(638),D=n(465),x=n(112),w=n(120),k=n(466),_=n(475),S=n(504),y=n(480),$=n(523),V=n(461),component=Object(d.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",{attrs:{color:"grey lighten-4",flat:"",tile:""}},[n("v-row",{class:"second-nav cusblue1 "+(this.$vuetify.breakpoint.xsOnly?"pb-2":""),attrs:{height:"55",align:"center",justify:"center",dense:"",flat:""}},[n("h1",{staticClass:"font-weight-medium col-sm-2 col-6 order-first"},[e._v("POS")]),e._v(" "),n("v-spacer"),e._v(" "),n("v-subheader",{directives:[{name:"show",rawName:"v-show",value:!this.$vuetify.breakpoint.smAndDown,expression:"!this.$vuetify.breakpoint.smAndDown"}],staticClass:"cus-subhead"},[e._v("\n      วันที่เริ่ม :\n    ")]),e._v(" "),n("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({staticClass:"rounded-lg cus-input mr-3",attrs:{"background-color":"cusblue3","append-icon":"mdi-calendar-month",dark:"",filled:"",rounded:"","single-line":"",dense:"",flat:"","hide-details":"",readonly:""},model:{value:e.start,callback:function(t){e.start=t},expression:"start"}},"v-text-field",o,!1),r))]}}]),model:{value:e.startMenuDate,callback:function(t){e.startMenuDate=t},expression:"startMenuDate"}},[e._v(" "),n("v-date-picker",{ref:"picker",attrs:{color:"cusblue",max:e.nowDate},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1),e._v(" "),n("v-subheader",{directives:[{name:"show",rawName:"v-show",value:!this.$vuetify.breakpoint.smAndDown,expression:"!this.$vuetify.breakpoint.smAndDown"}],staticClass:"cus-subhead"},[e._v("\n      วันที่สิ้นสุด :\n    ")]),e._v(" "),n("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({staticClass:"rounded-lg cus-input mr-3",attrs:{"background-color":"cusblue3","append-icon":"mdi-calendar-month",dark:"",filled:"",rounded:"","single-line":"",dense:"",flat:"","hide-details":"",readonly:""},model:{value:e.end,callback:function(t){e.end=t},expression:"end"}},"v-text-field",o,!1),r))]}}]),model:{value:e.endMenuDate,callback:function(t){e.endMenuDate=t},expression:"endMenuDate"}},[e._v(" "),n("v-date-picker",{ref:"picker",attrs:{color:"cusblue",max:e.nowDate},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1),e._v(" "),n("v-subheader",{directives:[{name:"show",rawName:"v-show",value:!this.$vuetify.breakpoint.smAndDown,expression:"!this.$vuetify.breakpoint.smAndDown"}],staticClass:"cus-subhead"},[e._v("\n      สถานะ :\n    ")]),e._v(" "),n("v-select",{class:e.$vuetify.breakpoint.xsOnly?"rounded-lg cus-input order-first":"rounded-lg cus-input",attrs:{items:e.status,"item-text":"label","item-value":"value","menu-props":{closeOnContentClick:!0},"background-color":"cusblue3","item-color":"cusblue",label:"ทั้งหมด",dark:"",filled:"",rounded:"","single-line":"",dense:"",flat:"","hide-details":""},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[n("v-list-item",{style:""===e.selectStatus?"background-color: #e2f5fc":"",attrs:{ripple:""},on:{click:function(t){e.selectStatus=""}}},[n("v-list-item-content",[n("v-list-item-title",{class:""===e.selectStatus?"cusblue--text":""},[e._v("\n              แสดงทั้งหมด\n            ")])],1)],1),e._v(" "),n("v-divider",{staticClass:"mt-2"})]},proxy:!0}]),model:{value:e.selectStatus,callback:function(t){e.selectStatus=t},expression:"selectStatus"}})],1)],1)}),[],!1,null,null,null),O=component.exports;f()(component,{VCard:h.a,VDatePicker:m.a,VDivider:D.a,VListItem:x.a,VListItemContent:w.a,VListItemTitle:w.b,VMenu:k.a,VRow:_.a,VSelect:S.a,VSpacer:y.a,VSubheader:$.a,VTextField:V.a});var C=n(487),I={data:function(){return{delId:"",whyDelDialig:!1,reason:"",valid:!1,rules:{reason:[function(e){return!!e||"กรุณากรอกเหตุผล"}]}}},watch:{whyDelDialig:function(e){!1===e&&(this.delId="",this.reason="",this.$refs.form.resetValidation())}},methods:{open:function(e){this.delId=e,this.whyDelDialig=!0},close:function(){this.whyDelDialig=!1},onSubmit:function(){this.$refs.form.validate()&&this.$emit("del",{id:this.delId,reason:this.reason})}}},M=n(110),P=n(62),Y=n(463),A=n(479),R=n(626),N=Object(d.a)(I,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{scrollable:"","max-width":"500px",transition:"dialog-transition"},model:{value:e.whyDelDialig,callback:function(t){e.whyDelDialig=t},expression:"whyDelDialig"}},[n("v-card",[n("h2",{staticClass:"pa-5 pb-2"},[e._v("เหตุผลที่ลบ")]),e._v(" "),n("v-divider"),e._v(" "),n("v-card-text",{staticClass:"py-3 px-7"},[n("v-form",{ref:"form",attrs:{"lazy-validation":"",autocomplete:"off"},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-textarea",{attrs:{rules:e.rules.reason,color:"cusblue",label:"เหตุผล","auto-grow":"","row-height":"24",rows:"1"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}})],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"cusblue2",text:""},on:{click:function(t){e.whyDelDialig=!1}}},[e._v("\n        ยกเลิก\n      ")]),e._v(" "),n("v-btn",{attrs:{disabled:!e.valid,color:"cusblue2",text:""},on:{click:e.onSubmit}},[e._v("\n        ยืนยัน\n      ")])],1)],1)],1)}),[],!1,null,null,null),j=N.exports;f()(N,{VBtn:M.a,VCard:h.a,VCardActions:P.a,VCardText:P.c,VDialog:Y.a,VDivider:D.a,VForm:A.a,VSpacer:y.a,VTextarea:R.a});var Q={components:{confirmDialog:C.a,reasonDialog:j},props:{posQueue:{type:Array,required:!1,default:null},state:{type:String,required:!0}},data:function(){return{confirmDel:!1,checkout:!1,headers:[{text:"ลำดับ",value:"id",align:"center",width:"100",sortable:!1,class:"font-weight-bold"},{text:"หมายเลขอ้างอิง",value:"refNumber",align:"center",width:"150",sortable:!1,class:"font-weight-bold"},{text:"ผู้ทำรายการ",value:"user",align:"center",width:"",sortable:!1},{text:"ลูกค้า",value:"customer",align:"center",width:"",sortable:!1},{text:"ทำรายการเมื่อ",value:"createAt",align:"center",width:"",sortable:!1},{text:"สถานะ",value:"state",align:"center",width:"",sortable:!1},{text:"จำนวนเงินสุทธิ",value:"netPrice",align:"right",width:"",sortable:!1},{text:"Action",value:"action",align:"center",width:"",sortable:!1}]}},methods:{orderNum:function(data,e){return data.map((function(e){return e.id})).indexOf(e)+1},delPOS:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$refs.confirm.open("คุณแน่ใจหรือไม่?","คุณแน่ใจหรือไม่ที่จะลบข้อมูลนี้",{width:290,color:"red"});case 2:if(n.sent){n.next=5;break}return n.abrupt("return");case 5:return n.prev=5,n.next=8,t.$axios.$delete("/api/pos/".concat(e),{progress:!1});case 8:t.changeState(e),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(5),alert(n.t0);case 14:case"end":return n.stop()}}),n,null,[[5,11]])})))()},reasonDel:function(e){this.$refs.reasonDialog.open(e)},delPOSSuccess:function(e){var t=this,n=e.id,r={cancelReason:e.reason};this.$axios({method:"DELETE",url:"/api/pos/".concat(n),data:r}).then((function(e){t.$refs.reasonDialog.close(),t.changeState(n)})).catch((function(e){alert(e)}))},getColor:function(e){return"cancel"===e?"rgb(255, 98, 98)":"pending"===e?"rgb(255, 191, 72)":"rgb(87, 243, 87)"},changeState:function(e){var t=this.posQueue.findIndex((function(t){return t.id===e}));""===this.state?this.posQueue[t].state="cancel":this.$emit("deletePOS",e)}}},E=n(464),T=n(639),B=n(184),z=Object(d.a)(Q,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-data-table",{staticClass:"elevation-4 overflow-y-auto",attrs:{headers:e.headers,items:e.posQueue,"disable-pagination":"","hide-default-footer":"",height:"calc(100vh - 160px)","fixed-header":""},scopedSlots:e._u([{key:"item.id",fn:function(t){var r=t.item;return[n("div",{staticClass:"text-center"},[e._v("\n        "+e._s(e.orderNum(e.posQueue,r.id))+"\n      ")])]}},{key:"item.state",fn:function(t){var r=t.item;return[n("div",{staticClass:"text-center"},[n("v-chip",{attrs:{color:e.getColor(r.state),dark:"",small:"",label:""}},[e._v("\n          "+e._s(r.state)+"\n        ")])],1)]}},{key:"item.refNumber",fn:function(t){var r=t.item;return[n("div",{staticClass:"font-weight-medium"},[n("nuxt-link",{staticClass:"bold-owner text-decoration-none text-truncate",attrs:{to:"/pos/"+r.id}},[e._v("\n          "+e._s(r.receiptNumber||r.posNumber)+"\n          "),n("v-icon",{attrs:{color:"cusblue2",small:""}},[e._v("mdi-chevron-right")])],1)],1)]}},{key:"item.user",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(n.receiptBy||n.createBy)+"\n    ")]}},{key:"item.createAt",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(e.$moment(n.receiptAt||n.createAt).format("DD/MM/YYYY HH:mm:ss"))+"\n    ")]}},{key:"item.netPrice",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(n.netPrice?(new Intl.NumberFormat).format(n.netPrice):"-")+"\n    ")]}},{key:"item.action",fn:function(t){var r=t.item;return[n("v-btn",{attrs:{disabled:"cancel"===r.state,icon:"",depressed:"","x-small":""},on:{click:function(t){"success"===r.state?e.reasonDel(r.id):e.delPOS(r.id)}}},[n("v-icon",[e._v("mdi-trash-can")])],1)]}}],null,!0)}),e._v(" "),n("confirmDialog",{ref:"confirm"}),e._v(" "),n("reasonDialog",{ref:"reasonDialog",on:{del:e.delPOSSuccess}})],1)}),[],!1,null,null,null),L=z.exports;f()(z,{VBtn:M.a,VChip:E.a,VDataTable:T.a,VIcon:B.a});var F={components:{posQueueNav:O,posQueue:L},validate:function(e){var t=e.store;return t.getters.loggedInUser.roles.some((function(e){return 6===e.id}))||t.getters.loggedInUser.isAdmin},asyncData:function(e){return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$axios,e.params,t.next=3,n.$get("/api/pos?state=pending&dateRange0=".concat(l()().subtract(3,"months").toISOString(),"&dateRange1=").concat(l()().toISOString()),{progress:!1});case 3:return r=t.sent,t.abrupt("return",{pos:r.results});case 5:case"end":return t.stop()}}),t)})))()},data:function(){return{select:"pending"}},methods:{addPosQueue:function(){var e=this;this.$axios.$post("/api/pos",null,{progress:!1}).then((function(t){e.$router.push("/pos/"+t.id)})).catch((function(e){alert(e)}))},updateStatus:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.select=e.state,r=l()(e.startDate).add(1,"days").toISOString(),o=l()(e.endDate).add(1,"days").toISOString(),n.next=5,t.$axios.$get("/api/pos?".concat(""!==e.state?"state=".concat(e.state,"&dateRange0=").concat(r,"&dateRange1=").concat(o):"states=pending&states=success&states=cancel&dateRange0=".concat(r,"&dateRange1=").concat(o)),{progress:!1});case 5:c=n.sent,t.pos=c.results;case 7:case"end":return n.stop()}}),n)})))()},deletePOS:function(e){var t=this.pos.findIndex((function(t){return t.id===e}));this.pos.splice(t,1)}}},H=Object(d.a)(F,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("posQueueNav",{on:{updateStatus:e.updateStatus}}),e._v(" "),n("div",{staticClass:"custom-container"},[n("posQueue",{attrs:{"pos-queue":e.pos,state:e.select},on:{deletePOS:e.deletePOS}})],1),e._v(" "),n("v-btn",{attrs:{color:"cusblue2",fixed:"",fab:"",small:this.$vuetify.breakpoint.mobile,large:!this.$vuetify.breakpoint.mobile,dark:"",bottom:"",right:""},on:{click:function(t){return t.stopPropagation(),e.addPosQueue(t)}}},[n("v-icon",[e._v("mdi-plus")])],1)],1)}),[],!1,null,null,null);t.default=H.exports;f()(H,{VBtn:M.a,VIcon:B.a})}}]);