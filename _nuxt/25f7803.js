(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{487:function(t,e,r){"use strict";r(4);var n={data:function(){return{isShowDialog:!1,resolve:null,reject:null,message:null,title:null,options:{color:"primary",width:290,zIndex:200}}},methods:{open:function(title,t,e){var r=this;return this.isShowDialog=!0,this.$nextTick((function(){return r.$refs.cancelDialog.$el.focus()})),this.title=title,this.message=t,this.options=Object.assign(this.options,e),new Promise((function(t,e){r.resolve=t,r.reject=e}))},agree:function(){this.isShowDialog=!1,this.resolve(!0),this.$emit("onOk")},cancel:function(){this.isShowDialog=!1,this.resolve(!1),this.$emit("onCancel")}}},o=r(41),c=r(50),l=r.n(c),d=r(110),m=r(183),v=r(62),h=r(463),f=r(480),component=Object(o.a)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{style:{zIndex:t.options.zIndex},attrs:{"max-width":t.options.width},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancel(e)}},model:{value:t.isShowDialog,callback:function(e){t.isShowDialog=e},expression:"isShowDialog"}},[r("v-card",[r("h2",{staticClass:"pl-6 pt-3 pb-2"},[t._v(t._s(t.title))]),t._v(" "),r("v-card-text",{directives:[{name:"show",rawName:"v-show",value:!!t.message,expression:"!!message"}]},[t._v(" "+t._s(t.message)+" ")]),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{ref:"btnOk",attrs:{color:t.options.color,text:""},nativeOn:{click:function(e){return t.agree(e)}}},[t._v("\n        ใช่\n      ")]),t._v(" "),r("v-btn",{ref:"cancelDialog",attrs:{color:"grey",text:""},nativeOn:{click:function(e){return t.cancel(e)}}},[t._v("\n        ไม่\n      ")])],1)],1)],1)}),[],!1,null,null,null);e.a=component.exports;l()(component,{VBtn:d.a,VCard:m.a,VCardActions:v.a,VCardText:v.c,VDialog:h.a,VSpacer:f.a})},499:function(t,e,r){var content=r(525);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(13).default)("74d4808e",content,!0,{sourceMap:!1})},500:function(t,e,r){var content=r(527);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(13).default)("413776e4",content,!0,{sourceMap:!1})},524:function(t,e,r){"use strict";var n=r(499);r.n(n).a},525:function(t,e,r){(e=r(12)(!1)).push([t.i,".v-card{transition:.2s ease-in-out}.img-cus{cursor:pointer!important}.img-cus .cus-row{transition:.2s ease-in-out;background:transparent}.img-cus .cus-icon{color:hsla(0,0%,100%,0)!important}.img-cus:hover .cus-icon{color:#fff!important}.img-cus:hover .cus-row{background:rgba(0,0,0,.3)}",""]),t.exports=e},526:function(t,e,r){"use strict";var n=r(500);r.n(n).a},527:function(t,e,r){(e=r(12)(!1)).push([t.i,"@media screen and (orientation:portrait){.responsive-img{max-height:100%;max-width:100%}}@media screen and (orientation:landscape){.responsive-img{max-height:100vh;max-width:100vh}}@media(min-width:1264px)and (max-width:1903px){.flex.lg5-custom{width:20%;max-width:20%;flex-basis:20%}}",""]),t.exports=e},533:function(t,e,r){"use strict";r(42);var n=r(7),o=(r(122),r(17),{props:{keys:{type:Number,required:!0},img:{type:Object,required:!0},delbtn:{default:!1,type:Boolean,required:!1}},data:function(){return{type:this.$store.state.form.mediaType}},mounted:function(){var t=this;0===this.$store.state.form.mediaType.length&&this.$store.dispatch("form/addMedia").then((function(e){t.type=e}))},methods:{getType:function(t){if(0!==this.type.length){var e=this.type.findIndex((function(e){return e.id===t}));return this.type[e].label}}}}),c=(r(524),r(41)),l=r(50),d=r.n(l),m=r(110),v=r(183),h=r(62),f=r(473),w=r(568),x=r(184),y=r(265),_=r(475),I=r(491),k=r.n(I),C=r(58),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-hover",{scopedSlots:t._u([{key:"default",fn:function(e){var n=e.hover;return[r("v-card",{staticClass:"mb-4 mx-2 overflow-auto",attrs:{elevation:n?12:2,"min-width":"282",width:"282",height:"270"}},[r("v-img",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"img-cus",attrs:{"lazy-src":t.img.media.url_thumbnail_sm,src:t.img.media.url,height:"180px"},on:{click:function(e){return t.$emit("imgclick",t.keys)}}},[n?r("v-row",{staticClass:"lightbox fill-height text-center cus-row",attrs:{align:"center",justify:"center"}},[r("v-col",[r("v-icon",{staticClass:"cus-icon",attrs:{large:""}},[t._v("mdi-arrow-expand-all")])],1)],1):t._e()],1),t._v(" "),r("v-card-title",[t._v(" "+t._s(t.img.description)+" ")]),t._v(" "),r("v-card-subtitle",[t._v(" "+t._s(t.getType(t.img.typeId))+" ")]),t._v(" "),t.delbtn?r("v-btn",{staticClass:"mb-2",attrs:{bottom:"",right:"",absolute:"",icon:""},on:{click:function(e){return t.$emit("delete",t.img.id)}}},[r("v-icon",[t._v("mdi-close")])],1):t._e()],1)]}}])})}),[],!1,null,null,null),V=component.exports;d()(component,{VBtn:m.a,VCard:v.a,VCardSubtitle:h.b,VCardTitle:h.d,VCol:f.a,VHover:w.a,VIcon:x.a,VImg:y.a,VRow:_.a}),k()(component,{Ripple:C.a});var $={components:{imgCard:V,confirmDialog:r(487).a},props:{images:{default:null,type:Array,required:!1},deletes:{default:!1,type:Boolean,required:!1}},data:function(){return{dialogImg:!1,imgShowing:0}},methods:{showImg:function(t){this.dialogImg=!0,this.imgShowing=t},delImg:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$refs.confirm.open("คุณแน่ใจหรือไม่?","คุณแน่ใจหรือไม่ที่จะลบภาพนี้",{width:290,color:"red"});case 2:if(r.sent){r.next=5;break}return r.abrupt("return");case 5:return r.prev=5,r.next=8,e.$axios.$delete("/api/visits/".concat(e.$route.params.queue,"/images/").concat(t),{progress:!1});case 8:e.$emit("delete",t),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),alert(r.t0);case 14:case"end":return r.stop()}}),r,null,[[5,11]])})))()}}},O=(r(526),r(573)),S=r(569),j=r(463),D=r(570),T=r(544),M=r(67),P=Object(c.a)($,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-layout",{attrs:{row:"",wrap:""}},t._l(t.images,(function(img,i){return r("v-flex",{key:i,staticClass:"lg5-custom",attrs:{xs12:"",sm6:"",md4:"",xl3:""}},[r("imgCard",{staticClass:"mx-auto",attrs:{keys:i,img:img,delbtn:t.deletes},on:{imgclick:t.showImg,delete:t.delImg}})],1)})),1),t._v(" "),r("v-dialog",{attrs:{"max-width":"100%",transition:"dialog-transition",fullscreen:""},model:{value:t.dialogImg,callback:function(e){t.dialogImg=e},expression:"dialogImg"}},[r("v-card",{staticClass:"pa-0",attrs:{height:"100vh",tile:""}},[r("v-btn",{staticClass:"white--text ma-4",attrs:{color:"rgba(0, 0, 0, 0.5)",depressed:"",absolute:"",fab:"",small:""},on:{click:function(e){t.dialogImg=!1}}},[r("v-icon",[t._v("mdi-close")])],1),t._v(" "),r("v-card-text",{staticClass:"pa-0"},[r("v-carousel",{attrs:{height:"100vh","hide-delimiters":""},model:{value:t.imgShowing,callback:function(e){t.imgShowing=e},expression:"imgShowing"}},t._l(t.images,(function(img,i){return r("v-carousel-item",{key:i,attrs:{src:img.media.url}},[r("v-sheet",{attrs:{color:"rgba(0, 0, 0, 0.5)",height:"100%",tile:""}},[r("v-row",{staticClass:"fill-height",attrs:{align:"center",justify:"center","no-gutters":""}},[r("div",{staticClass:"responsive-img"},[r("v-img",{attrs:{src:img.media.url,"lazy-src":img.media.url_thumbnail_sm}})],1)])],1)],1)})),1)],1)],1)],1),t._v(" "),r("confirmDialog",{ref:"confirm"})],1)}),[],!1,null,null,null);e.a=P.exports;d()(P,{VBtn:m.a,VCard:v.a,VCardText:h.c,VCarousel:O.a,VCarouselItem:S.a,VDialog:j.a,VFlex:D.a,VIcon:x.a,VImg:y.a,VLayout:T.a,VRow:_.a,VSheet:M.a})},557:function(t,e,r){var content=r(621);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(13).default)("b67ee294",content,!0,{sourceMap:!1})},620:function(t,e,r){"use strict";var n=r(557);r.n(n).a},621:function(t,e,r){(e=r(12)(!1)).push([t.i,"#painterro{position:fixed;top:0;right:0;bottom:0;left:0;z-index:100;opacity:1;transition:opacity .3s}.preview-img{max-height:300px;max-height:100%;background:#f0f0f0;border-radius:10px;margin:10px 0}.ptro-icon-btn,.ptro-pallet,.ptro-resize-widget,.ptro-settings-widget{border-radius:10px;transition:.3s}.ptro-named-btn{border-radius:10px;padding:0 10px}.ptro-icon-btn[disabled=true]{color:#9e9e9e;background:#1397bb}.ptro-color-widget-wrapper[hidden=true],.ptro-resize-widget-wrapper[hidden=true],.ptro-settings-widget-wrapper[hidden=true]{opacity:0;transition:opacity .3s}.ptro-color-widget-wrapper,.ptro-resize-widget-wrapper,.ptro-settings-widget-wrapper{opacity:1;transition:opacity .3s}[hidden]{display:block;visibility:hidden}[hidden] #painterro-bar,[hidden] #painterro-wrapper{opacity:0;transition:opacity .3s}#painterro-bar,#painterro-wrapper{opacity:1;transition:opacity .3s}",""]),t.exports=e},637:function(t,e,r){"use strict";r.r(e);r(122),r(42);var n=r(7),o={data:function(){return{type:this.$store.state.form.mediaType,select:""}},watch:{select:function(t){this.$emit("select",t)}},mounted:function(){var t=this;0===this.$store.state.form.mediaType.length&&this.$store.dispatch("form/addMedia").then((function(e){t.type=e}))}},c=r(41),l=r(50),d=r.n(l),m=r(473),v=r(465),h=r(112),f=r(120),w=r(475),x=r(504),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{staticClass:"cusblue1 second-nav1",attrs:{align:"center",justify:"center",dense:""}},[r("v-col",{attrs:{lg:"10",md:"9",sm:"8",cols:"6"}},[r("h1",{staticClass:"font-weight-medium"},[t._v("แนบรูป")])]),t._v(" "),r("v-col",{attrs:{lg:"2",md:"3",sm:"4",cols:"6"}},[r("v-select",{staticClass:"rounded-lg cus-input mr-3",attrs:{items:t.type,"item-text":"label","item-value":"id","background-color":"cusblue3","item-color":"cusblue",label:"ทั้งหมด",dark:"",filled:"",rounded:"","single-line":"",dense:"",flat:"","hide-details":""},scopedSlots:t._u([{key:"prepend-item",fn:function(){return[r("v-list-item",{style:""===t.select?"background-color: #e2f5fc":"",attrs:{ripple:""},on:{click:function(e){t.select=""}}},[r("v-list-item-content",[r("v-list-item-title",{class:""===t.select?"cusblue--text":""},[t._v("\n              แสดงทั้งหมด\n            ")])],1)],1),t._v(" "),r("v-divider",{staticClass:"mt-2"})]},proxy:!0}]),model:{value:t.select,callback:function(e){t.select=e},expression:"select"}})],1)],1)}),[],!1,null,null,null),y=component.exports;d()(component,{VCol:m.a,VDivider:v.a,VListItem:h.a,VListItemContent:f.a,VListItemTitle:f.b,VRow:w.a,VSelect:x.a});var _=r(533),I=(r(11),r(9),r(6),r(4),r(10),r(1)),k=r(619),C=r.n(k),V=r(2);function $(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var O={data:function(){return{assignModal:!1,painterro:null,type:this.$store.state.form.mediaType,loading:!1,addImg:{img:"",previewImg:"",description:"",type:1}}},watch:{assignModal:function(t){!1===t&&(this.addImg={img:"",previewImg:"",description:"",type:1})}},mounted:function(){var t=this;0===this.$store.state.form.mediaType.length&&this.$store.dispatch("form/addMedia").then((function(e){t.type=e})),V.a.nextTick((function(){t.painterro=C()({id:"painterro",colorScheme:{main:"#49bfe8",control:"#148cad",controlContent:"#ffffff",activeControl:"#0d6c86",activeControlContent:"#c9c9c9",toolControlNameColor:"#148cad",hoverControlContent:"rgb(211, 211, 211)"},saveHandler:function(image,e){t.addImg.img=image,t.addImg.previewImg=image.asDataURL(),e(!0),t.assignModal=!0}})}))},methods:{openDialog:function(){this.painterro.show()},submitImg:function(){var t=this;this.loading=!0;var e=function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?$(Object(source),!0).forEach((function(e){Object(I.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):$(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},this.addImg),r=new File([e.img.asBlob("image/png")],"file.png",{type:"image/png"}),n=new FormData;n.append("image",r),n.append("description",e.description),n.append("typeId",e.type),this.$axios.$post("/api/visits/".concat(this.$route.params.queue,"/images"),n,{headers:{"Content-Type":"multipart/form-data"},progress:!1}).then((function(data){setTimeout((function(){t.$emit("add",data),t.loading=!1,t.assignModal=!1}),500)})).catch((function(t){alert(t)}))}}},S=(r(620),r(110)),j=r(183),D=r(62),T=r(463),M=r(184),P=r(265),R=r(175),z=r(480),E=r(626),B=Object(c.a)(O,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-btn",{key:t.$nuxt.$route.path,attrs:{color:"cusblue2",fixed:"",fab:"",small:this.$vuetify.breakpoint.mobile,large:!this.$vuetify.breakpoint.mobile,dark:"",bottom:"",right:""},on:{click:function(e){return e.stopPropagation(),t.openDialog(e)}}},[r("v-icon",[t._v("mdi-plus")])],1),t._v(" "),r("div",{ref:"paint",attrs:{id:"painterro"}}),t._v(" "),r("v-dialog",{attrs:{"max-width":"500",scrollable:""},model:{value:t.assignModal,callback:function(e){t.assignModal=e},expression:"assignModal"}},[r("v-card",[r("h2",{staticClass:"pa-5 pb-2"},[t._v("อัพโหลดไฟล์")]),t._v(" "),r("v-divider",{staticClass:"darker-divider"}),t._v(" "),r("v-card-text",{staticClass:"px-7"},[r("div",{staticClass:"preview-img"},[r("v-img",{staticClass:"pa-3",attrs:{src:t.addImg.previewImg,height:"300",contain:""}})],1),t._v(" "),r("v-select",{staticClass:"rounded-lg",attrs:{disabled:t.loading,items:t.type,"item-text":"label","item-value":"id","item-color":"cusblue",label:"ประเภท"},model:{value:t.addImg.type,callback:function(e){t.$set(t.addImg,"type",e)},expression:"addImg.type"}}),t._v(" "),r("v-textarea",{attrs:{disabled:t.loading,color:"cusblue",label:"รายละเอียด","auto-grow":"","row-height":"24",rows:"1"},model:{value:t.addImg.description,callback:function(e){t.$set(t.addImg,"description",e)},expression:"addImg.description"}})],1),t._v(" "),r("v-card-actions",[r("v-spacer"),t._v(" "),r("v-btn",{staticClass:"cusblue2--text text-none",attrs:{disabled:t.loading,text:""},on:{click:t.submitImg}},[r("v-progress-circular",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"mr-2",attrs:{indeterminate:"",color:"cusblue2",size:15,width:2}}),t._v("\n          บันทึก\n        ")],1)],1)],1)],1)],1)}),[],!1,null,null,null),N=B.exports;d()(B,{VBtn:S.a,VCard:j.a,VCardActions:D.a,VCardText:D.c,VDialog:T.a,VDivider:v.a,VIcon:M.a,VImg:P.a,VProgressCircular:R.a,VSelect:x.a,VSpacer:z.a,VTextarea:E.a});var L={components:{imgNav:y,images:_.a,insertDialog:N},validate:function(t){return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.$axios,n=t.params,t.query,!(o=t.store).getters.loggedInUser.roles.some((function(t){return 2===t.id}))&&!o.getters.loggedInUser.isAdmin){e.next=12;break}return e.next=4,r.$get("/api/visits/".concat(n.queue),{progress:!1});case 4:if(1!==(c=e.sent).visitStatus.id&&2!==c.visitStatus.id&&3!==c.visitStatus.id&&4!==c.visitStatus.id){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=13;break;case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)})))()},asyncData:function(t){return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,img;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$axios,n=t.params,e.next=3,r.$get("/api/visits/".concat(n.queue,"/images"),{progress:!1});case 3:return img=e.sent,e.abrupt("return",{images:img});case 5:case"end":return e.stop()}}),e)})))()},data:function(){return{type:""}},computed:{filterImg:function(){var t=this;return this.images.filter((function(img){return""===t.type?img.typeId:img.typeId===t.type}))}},methods:{changeSelect:function(t){this.type=t},addImg:function(img){var t={id:img.id,description:img.description,media:{id:img.image.id,url:img.image.url,url_thumbnail:img.image.url_thumbnail,url_thumbnail_sm:img.image.url_thumbnail_sm},typeId:img.typeId,visitId:img.visitId};this.images.push(t)},deleteImg:function(t){var e=this.images.findIndex((function(img){return img.id===t}));this.images.splice(e,1)}}},A=Object(c.a)(L,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("imgNav",{on:{select:this.changeSelect}}),this._v(" "),e("div",{staticClass:"custom-container"},[e("images",{attrs:{images:this.filterImg,deletes:!0},on:{delete:this.deleteImg}})],1),this._v(" "),e("insertDialog",{on:{add:this.addImg}})],1)}),[],!1,null,null,null);e.default=A.exports}}]);